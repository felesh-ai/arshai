<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="Embedding Implementations" href="embeddings.html"><link rel="prev" title="Redis Memory Manager" href="../memory/redis-memory.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Component Reference Implementations - Arshai Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Arshai Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">Arshai Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a><input aria-label="Toggle navigation of Getting Started" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/comprehensive-guide.html">Comprehensive Agent Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/first-agent.html">Build Your First Custom Agent</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/comprehensive-guide.html">Comprehensive Agent Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Philosophy</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../philosophy/index.html">Philosophy</a><input aria-label="Toggle navigation of Philosophy" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../philosophy/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../philosophy/three-layer-architecture.html">Three-Layer Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../philosophy/developer-authority.html">Developer Authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../philosophy/design-decisions.html">Design Decisions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy/three-layer-architecture.html">Three-Layer Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy/developer-authority.html">Developer Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy/design-decisions.html">Design Decisions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Framework (Core)</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/index.html">Framework Core</a><input aria-label="Toggle navigation of Framework Core" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../framework/llm-clients/index.html">LLM Clients (Layer 1)</a><input aria-label="Toggle navigation of LLM Clients (Layer 1)" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/interface-overview.html">ILLM Interface Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/openai-client.html">OpenAI Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/azure-client.html">Azure OpenAI Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/google-gemini-client.html">Google Gemini Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/openrouter-client.html">OpenRouter Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/llm-clients/extending-llm-clients.html">Extending LLM Clients</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../framework/agents/index.html">Agents (Layer 2)</a><input aria-label="Toggle navigation of Agents (Layer 2)" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/base-agent.html">BaseAgent Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/creating-agents.html">Creating Agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/tools-and-callables.html">Tools and Callables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/agent-patterns.html">Agent Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/stateless-design.html">Stateless Agent Design</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../framework/agents/examples/index.html">Agent Examples</a><input aria-label="Toggle navigation of Agent Examples" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../framework/agents/examples/01-basic-usage.html">Example 01: Basic Agent Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../framework/agents/examples/02-custom-agents.html">Example 02: Creating Custom Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../framework/agents/examples/03-memory-patterns.html">Example 3: Memory Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../framework/agents/examples/04-tool-integration.html">Example 4: Tool Integration</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../agents/index.html">Agent Reference Implementations</a><input aria-label="Toggle navigation of Agent Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../agents/working-memory-agent.html">WorkingMemoryAgent Reference Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../framework/building-systems/index.html">Building Systems (Layer 3)</a><input aria-label="Toggle navigation of Building Systems (Layer 3)" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../framework/building-systems/composition-patterns.html">Example 5: Agent Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/building-systems/building-agentic-systems.html">Building Agentic Systems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/llm-clients/index.html">LLM Clients (Layer 1)</a><input aria-label="Toggle navigation of LLM Clients (Layer 1)" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/interface-overview.html">ILLM Interface Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/openai-client.html">OpenAI Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/azure-client.html">Azure OpenAI Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/google-gemini-client.html">Google Gemini Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/openrouter-client.html">OpenRouter Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/llm-clients/extending-llm-clients.html">Extending LLM Clients</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/agents/index.html">Agents (Layer 2)</a><input aria-label="Toggle navigation of Agents (Layer 2)" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/agents/base-agent.html">BaseAgent Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/agents/creating-agents.html">Creating Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/agents/tools-and-callables.html">Tools and Callables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/agents/agent-patterns.html">Agent Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/agents/stateless-design.html">Stateless Agent Design</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../framework/agents/examples/index.html">Agent Examples</a><input aria-label="Toggle navigation of Agent Examples" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/examples/01-basic-usage.html">Example 01: Basic Agent Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/examples/02-custom-agents.html">Example 02: Creating Custom Agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/examples/03-memory-patterns.html">Example 3: Memory Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../framework/agents/examples/04-tool-integration.html">Example 4: Tool Integration</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../agents/index.html">Agent Reference Implementations</a><input aria-label="Toggle navigation of Agent Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../agents/working-memory-agent.html">WorkingMemoryAgent Reference Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/building-systems/index.html">Building Systems (Layer 3)</a><input aria-label="Toggle navigation of Building Systems (Layer 3)" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/building-systems/composition-patterns.html">Example 5: Agent Composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/building-systems/building-agentic-systems.html">Building Agentic Systems</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Implementations (Reference)</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Reference Implementations</a><input aria-label="Toggle navigation of Reference Implementations" checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../agents/index.html">Agent Reference Implementations</a><input aria-label="Toggle navigation of Agent Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../agents/working-memory-agent.html">WorkingMemoryAgent Reference Implementation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orchestration/index.html">Orchestration Reference Implementations</a><input aria-label="Toggle navigation of Orchestration Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orchestration/workflow-system.html">Workflow System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orchestration/building-your-own.html">Building Your Own Orchestration</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../memory/index.html">Memory Reference Implementations</a><input aria-label="Toggle navigation of Memory Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../memory/in-memory.html">In-Memory Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory/redis-memory.html">Redis Memory Manager</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="current reference internal" href="#">Component Reference Implementations</a><input aria-label="Toggle navigation of Component Reference Implementations" checked="" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="embeddings.html">Embedding Implementations</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector-databases.html">Vector Database - Milvus Client</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../agents/index.html">Agent Reference Implementations</a><input aria-label="Toggle navigation of Agent Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../agents/working-memory-agent.html">WorkingMemoryAgent Reference Implementation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../orchestration/index.html">Orchestration Reference Implementations</a><input aria-label="Toggle navigation of Orchestration Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/workflow-system.html">Workflow System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/building-your-own.html">Building Your Own Orchestration</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../memory/index.html">Memory Reference Implementations</a><input aria-label="Toggle navigation of Memory Reference Implementations" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory/in-memory.html">In-Memory Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/redis-memory.html">Redis Memory Manager</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children current-page"><a class="current reference internal" href="#">Component Reference Implementations</a><input aria-label="Toggle navigation of Component Reference Implementations" checked="" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html">Embedding Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html">Vector Database - Milvus Client</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/simple-chatbot.html">Building a Simple Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/rag-system.html">Building a RAG System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/custom-system.html">Building a Custom Agentic System</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/interfaces.html">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/base-classes.html">Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/models.html">Models</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../extending/index.html">Extending Arshai</a><input aria-label="Toggle navigation of Extending Arshai" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../extending/custom-agents.html">Building Custom Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extending/custom-llm-clients.html">Adding LLM Providers</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/nimunzn/arshai/blob/main/docs_sphinx/implementations/components/index.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/nimunzn/arshai/edit/main/docs_sphinx/implementations/components/index.rst" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="component-reference-implementations">
<h1>Component Reference Implementations<a class="headerlink" href="#component-reference-implementations" title="Link to this heading">¶</a></h1>
<p>This section documents the reference component implementations provided with Arshai. These demonstrate how to implement various framework interfaces for embeddings, vector databases, and other system components.</p>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Component Implementations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="embeddings.html">Embedding Implementations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#openai-embeddings">OpenAI Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#voyageai-embeddings">VoyageAI Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#mgte-embeddings">MGTE Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#error-handling">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#choosing-an-embedding-provider">Choosing an Embedding Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#building-custom-embeddings">Building Custom Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#integration-with-vector-databases">Integration with Vector Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddings.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vector-databases.html">Vector Database - Milvus Client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#milvus-setup">Milvus Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#collection-management">Collection Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#data-operations">Data Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#search-operations">Search Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#hybrid-search">Hybrid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#advanced-patterns">Advanced Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#production-patterns">Production Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#performance-optimization">Performance Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#building-custom-vector-db-client">Building Custom Vector DB Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector-databases.html#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Reference Implementation Philosophy</strong></p>
<p>These component implementations are <strong>not part of the core framework</strong>. They represent working examples of how to implement framework interfaces for different providers and use cases. You can:</p>
<ul class="simple">
<li><p>Use them directly if they support your required providers</p></li>
<li><p>Modify them for your specific integration needs</p></li>
<li><p>Learn implementation patterns to build your own components</p></li>
<li><p>Combine multiple implementations for different scenarios</p></li>
</ul>
</div>
<section id="available-reference-implementations">
<h2>Available Reference Implementations<a class="headerlink" href="#available-reference-implementations" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><strong>Embedding Implementations</strong> (<a class="reference internal" href="embeddings.html"><span class="doc">Embedding Implementations</span></a>)</dt><dd><p>Working implementations for different embedding providers: OpenAI, VoyageAI, and MGTE. Demonstrate the <code class="docutils literal notranslate"><span class="pre">IEmbedding</span></code> interface implementation patterns.</p>
</dd>
<dt><strong>Vector Database Implementations</strong> (<a class="reference internal" href="vector-databases.html"><span class="doc">Vector Database - Milvus Client</span></a>)</dt><dd><p>Production-ready Milvus vector database client showing how to implement the <code class="docutils literal notranslate"><span class="pre">IVectorDBClient</span></code> interface.</p>
</dd>
</dl>
</section>
<section id="component-integration-patterns">
<h2>Component Integration Patterns<a class="headerlink" href="#component-integration-patterns" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><strong>Interface Implementation</strong></dt><dd><p>How reference components properly implement framework interfaces to ensure compatibility and consistency.</p>
</dd>
<dt><strong>Provider Abstraction</strong></dt><dd><p>Patterns for abstracting different service providers behind common interfaces.</p>
</dd>
<dt><strong>Configuration Management</strong></dt><dd><p>How components handle configuration, credentials, and environment-specific settings.</p>
</dd>
<dt><strong>Error Handling</strong></dt><dd><p>Robust error handling patterns that gracefully handle provider-specific failures.</p>
</dd>
<dt><strong>Async Operations</strong></dt><dd><p>How components implement asynchronous operations for better performance and scalability.</p>
</dd>
</dl>
</section>
<section id="framework-interface-compliance">
<h2>Framework Interface Compliance<a class="headerlink" href="#framework-interface-compliance" title="Link to this heading">¶</a></h2>
<p>All reference component implementations follow their respective framework interfaces:</p>
<p><strong>Embedding Interface (IEmbedding)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iembedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">IEmbedding</span><span class="p">,</span> <span class="n">EmbeddingConfig</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IEmbedding</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for embedding implementations.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dimension of embeddings produced by this service.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embeddings for multiple documents.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embeddings for a single document.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aembed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Asynchronously generate embeddings for multiple documents.&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p><strong>Vector Database Interface (IVectorDBClient)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.ivector_db_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">IVectorDBClient</span><span class="p">,</span> <span class="n">ICollectionConfig</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IVectorDBClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for vector database implementations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to the vector database.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_or_create_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get existing collection or create new one.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">documents_embedding</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert documents with embeddings into collection.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_by_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">,</span> <span class="n">query_vectors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search documents using vector similarity.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hybrid_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">,</span> <span class="n">dense_vectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sparse_vectors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform hybrid search using multiple vector types.&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="basic-usage-patterns">
<h2>Basic Usage Patterns<a class="headerlink" href="#basic-usage-patterns" title="Link to this heading">¶</a></h2>
<p><strong>Embedding Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.embeddings.openai_embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIEmbedding</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iembedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmbeddingConfig</span>

<span class="c1"># Create embedding configuration</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">EmbeddingConfig</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
<span class="p">)</span>

<span class="c1"># Create embedding service</span>
<span class="n">embedding_service</span> <span class="o">=</span> <span class="n">OpenAIEmbedding</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Generate embeddings</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="s2">&quot;How are you?&quot;</span><span class="p">,</span> <span class="s2">&quot;Machine learning is fascinating&quot;</span><span class="p">]</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="s1">&#39;dense&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> embeddings&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Embedding dimension: </span><span class="si">{</span><span class="n">embedding_service</span><span class="o">.</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Vector Database Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.vector_db.milvus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MilvusClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.ivector_db_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">ICollectionConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Set environment variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_HOST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_PORT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;19530&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_DB_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

<span class="c1"># Create vector database client</span>
<span class="n">vector_client</span> <span class="o">=</span> <span class="n">MilvusClient</span><span class="p">()</span>

<span class="c1"># Configure collection</span>
<span class="n">collection_config</span> <span class="o">=</span> <span class="n">ICollectionConfig</span><span class="p">(</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;my_documents&quot;</span><span class="p">,</span>
    <span class="n">dense_dim</span><span class="o">=</span><span class="mi">1536</span><span class="p">,</span>  <span class="c1"># For OpenAI embeddings</span>
    <span class="n">is_hybrid</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Dense vectors only</span>
<span class="p">)</span>

<span class="c1"># Prepare documents and embeddings</span>
<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Document 1 content&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;file1.txt&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Document 2 content&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;file2.txt&quot;</span><span class="p">}}</span>
<span class="p">]</span>

<span class="c1"># Get embeddings</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

<span class="c1"># Insert into vector database</span>
<span class="n">vector_client</span><span class="o">.</span><span class="n">insert_entities</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">collection_config</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
    <span class="n">documents_embedding</span><span class="o">=</span><span class="n">embeddings</span>
<span class="p">)</span>

<span class="c1"># Search similar documents</span>
<span class="n">query_text</span> <span class="o">=</span> <span class="s2">&quot;Tell me about document content&quot;</span>
<span class="n">query_embedding</span> <span class="o">=</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_document</span><span class="p">(</span><span class="n">query_text</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">vector_client</span><span class="o">.</span><span class="n">search_by_vector</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">collection_config</span><span class="p">,</span>
    <span class="n">query_vectors</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">]],</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Combined RAG System</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.embeddings.openai_embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIEmbedding</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.vector_db.milvus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MilvusClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.agents.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iagent</span><span class="w"> </span><span class="kn">import</span> <span class="n">IAgentInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.illm</span><span class="w"> </span><span class="kn">import</span> <span class="n">ILLMInput</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RAGAgent</span><span class="p">(</span><span class="n">BaseAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that uses embeddings and vector search for RAG.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_client</span><span class="p">,</span> <span class="n">embedding_service</span><span class="p">,</span> <span class="n">vector_client</span><span class="p">,</span> <span class="n">collection_config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">llm_client</span><span class="p">,</span> <span class="s2">&quot;You are a helpful assistant with access to documents&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_service</span> <span class="o">=</span> <span class="n">embedding_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_client</span> <span class="o">=</span> <span class="n">vector_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_config</span> <span class="o">=</span> <span class="n">collection_config</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">IAgentInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Get query embedding</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_document</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># Search for relevant documents</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_client</span><span class="o">.</span><span class="n">search_by_vector</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_config</span><span class="p">,</span>
            <span class="n">query_vectors</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">]],</span>
            <span class="n">limit</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>

        <span class="c1"># Extract relevant content</span>
        <span class="n">context_docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># First query results</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">context_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_docs</span><span class="p">)</span>

        <span class="c1"># Generate response with context</span>
        <span class="n">llm_input</span> <span class="o">=</span> <span class="n">ILLMInput</span><span class="p">(</span>
            <span class="n">system_prompt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">system_prompt</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Relevant context:</span><span class="se">\n</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">user_message</span><span class="o">=</span><span class="nb">input</span><span class="o">.</span><span class="n">message</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">llm_input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;llm_response&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="component-extension-patterns">
<h2>Component Extension Patterns<a class="headerlink" href="#component-extension-patterns" title="Link to this heading">¶</a></h2>
<p><strong>Custom Embedding Provider</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iembedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">IEmbedding</span><span class="p">,</span> <span class="n">EmbeddingConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomEmbeddingProvider</span><span class="p">(</span><span class="n">IEmbedding</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom embedding provider implementation.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">EmbeddingConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_endpoint</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_name</span>  <span class="c1"># Using model_name for endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dimension</span> <span class="o">=</span> <span class="mi">768</span>  <span class="c1"># Custom provider dimension</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimension</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embeddings using custom API.&quot;&quot;&quot;</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">texts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span>

            <span class="c1"># Call custom embedding API</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api_endpoint</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;texts&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="p">},</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="n">batch_embeddings</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">]</span>
            <span class="n">embeddings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_embeddings</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dense&quot;</span><span class="p">:</span> <span class="n">embeddings</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dense&quot;</span><span class="p">:</span> <span class="n">embeddings</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aembed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># Implement async version</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
                <span class="n">batch</span> <span class="o">=</span> <span class="n">texts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span>
                <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_embed_batch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

            <span class="n">batch_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

            <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">batch_embeddings</span> <span class="ow">in</span> <span class="n">batch_results</span><span class="p">:</span>
                <span class="n">embeddings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_embeddings</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dense&quot;</span><span class="p">:</span> <span class="n">embeddings</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_async_embed_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">texts</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_endpoint</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;texts&quot;</span><span class="p">:</span> <span class="n">texts</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Custom Vector Database Client</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.ivector_db_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">IVectorDBClient</span><span class="p">,</span> <span class="n">ICollectionConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SQLiteVectorClient</span><span class="p">(</span><span class="n">IVectorDBClient</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple SQLite-based vector database for development.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vectors.db&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to SQLite database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA journal_mode=WAL&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_or_create_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create table if it doesn&#39;t exist.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> (</span>
<span class="s2">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">                content TEXT NOT NULL,</span>
<span class="s2">                metadata TEXT,</span>
<span class="s2">                vector BLOB,</span>
<span class="s2">                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">collection_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">documents_embedding</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert documents with embeddings.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">vector_blob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">documents_embedding</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span>
<span class="s2">                (content, metadata, vector) VALUES (?, ?, ?)</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
                <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="n">vector_blob</span>
            <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_by_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ICollectionConfig</span><span class="p">,</span> <span class="n">query_vectors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple cosine similarity search.&quot;&quot;&quot;</span>
        <span class="n">query_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">query_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT id, content, metadata, vector FROM </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">doc_id</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">vector_blob</span> <span class="o">=</span> <span class="n">row</span>
            <span class="n">doc_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">vector_blob</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="c1"># Calculate cosine similarity</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">query_vector</span><span class="p">,</span> <span class="n">doc_vector</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">query_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">doc_vector</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
                <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="n">similarity</span>
            <span class="p">})</span>

        <span class="c1"># Sort by similarity and return top results</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;similarity&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">results</span><span class="p">[:</span><span class="n">limit</span><span class="p">]]</span>
</pre></div>
</div>
<p><strong>Configuration-Driven Component Factory</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iembedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">IEmbedding</span><span class="p">,</span> <span class="n">EmbeddingConfig</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ComponentFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory for creating components based on configuration.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_providers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">IEmbedding</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_db_providers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">IVectorDBClient</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_embedding_provider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">IEmbedding</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register an embedding provider.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_providers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">provider_class</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_vector_db_provider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">IVectorDBClient</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a vector database provider.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_db_providers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">provider_class</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_embedding_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">EmbeddingConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IEmbedding</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create embedding service based on provider name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_providers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown embedding provider: </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">provider_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_providers</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">provider_class</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_vector_db_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IVectorDBClient</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create vector database client based on provider name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_db_providers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown vector database provider: </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">provider_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_db_providers</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">provider_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">ComponentFactory</span><span class="p">()</span>

<span class="c1"># Register providers</span>
<span class="n">factory</span><span class="o">.</span><span class="n">register_embedding_provider</span><span class="p">(</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span> <span class="n">OpenAIEmbedding</span><span class="p">)</span>
<span class="n">factory</span><span class="o">.</span><span class="n">register_embedding_provider</span><span class="p">(</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">CustomEmbeddingProvider</span><span class="p">)</span>
<span class="n">factory</span><span class="o">.</span><span class="n">register_vector_db_provider</span><span class="p">(</span><span class="s2">&quot;milvus&quot;</span><span class="p">,</span> <span class="n">MilvusClient</span><span class="p">)</span>
<span class="n">factory</span><span class="o">.</span><span class="n">register_vector_db_provider</span><span class="p">(</span><span class="s2">&quot;sqlite&quot;</span><span class="p">,</span> <span class="n">SQLiteVectorClient</span><span class="p">)</span>

<span class="c1"># Create components from configuration</span>
<span class="n">embedding_config</span> <span class="o">=</span> <span class="n">EmbeddingConfig</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">)</span>
<span class="n">embedding_service</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_embedding_service</span><span class="p">(</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span> <span class="n">embedding_config</span><span class="p">)</span>
<span class="n">vector_client</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_vector_db_client</span><span class="p">(</span><span class="s2">&quot;milvus&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing-component-implementations">
<h2>Testing Component Implementations<a class="headerlink" href="#testing-component-implementations" title="Link to this heading">¶</a></h2>
<p><strong>Unit Testing Embeddings</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">patch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.embeddings.openai_embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIEmbedding</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.iembedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmbeddingConfig</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">embedding_config</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">EmbeddingConfig</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_openai_response</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Mock</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Mock</span><span class="p">(</span><span class="n">embedding</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]),</span>
        <span class="n">Mock</span><span class="p">(</span><span class="n">embedding</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
    <span class="p">])</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;arshai.embeddings.openai_embeddings.OpenAI&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_embed_documents</span><span class="p">(</span><span class="n">mock_openai_class</span><span class="p">,</span> <span class="n">embedding_config</span><span class="p">,</span> <span class="n">mock_openai_response</span><span class="p">):</span>
    <span class="c1"># Setup mock</span>
    <span class="n">mock_client</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock_openai_class</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_client</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_openai_response</span>

    <span class="c1"># Create embedding service</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="s1">&#39;os.environ&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">:</span> <span class="s1">&#39;test-key&#39;</span><span class="p">}):</span>
        <span class="n">embedding_service</span> <span class="o">=</span> <span class="n">OpenAIEmbedding</span><span class="p">(</span><span class="n">embedding_config</span><span class="p">)</span>

    <span class="c1"># Test embedding generation</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hello world&quot;</span><span class="p">,</span> <span class="s2">&quot;How are you?&quot;</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

    <span class="c1"># Verify results</span>
    <span class="k">assert</span> <span class="s2">&quot;dense&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>

    <span class="c1"># Verify API call</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
        <span class="nb">input</span><span class="o">=</span><span class="n">texts</span><span class="p">,</span>
        <span class="n">encoding_format</span><span class="o">=</span><span class="s2">&quot;float&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>Integration Testing Vector Database</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.vector_db.milvus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MilvusClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">arshai.core.interfaces.ivector_db_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">ICollectionConfig</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_milvus_integration</span><span class="p">():</span>
    <span class="c1"># Set up test environment</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_HOST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_PORT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;19530&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MILVUS_DB_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;test_db&quot;</span>

    <span class="c1"># Create client and config</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">MilvusClient</span><span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ICollectionConfig</span><span class="p">(</span>
        <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;test_collection&quot;</span><span class="p">,</span>
        <span class="n">dense_dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">is_hybrid</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test collection creation</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_or_create_collection</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">collection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># Test document insertion</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Test document 1&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Test document 2&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">}}</span>
        <span class="p">]</span>

        <span class="n">embeddings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dense&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]]</span>
        <span class="p">}</span>

        <span class="n">client</span><span class="o">.</span><span class="n">insert_entities</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">documents</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Test search</span>
        <span class="n">query_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_by_vector</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">query_vectors</span><span class="o">=</span><span class="p">[</span><span class="n">query_vector</span><span class="p">],</span>
            <span class="n">limit</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Cleanup - delete test collection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">delete_entity</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;metadata[&#39;type&#39;] == &#39;test&#39;&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p><strong>Performance Testing</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_embedding_performance</span><span class="p">():</span>
    <span class="n">embedding_service</span> <span class="o">=</span> <span class="n">OpenAIEmbedding</span><span class="p">(</span><span class="n">EmbeddingConfig</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">))</span>

    <span class="c1"># Generate test data</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Test document </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

    <span class="c1"># Test synchronous performance</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
    <span class="n">sync_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Synchronous embedding of 1000 texts: </span><span class="si">{</span><span class="n">sync_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1000</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_embedding_performance</span><span class="p">():</span>
    <span class="n">embedding_service</span> <span class="o">=</span> <span class="n">OpenAIEmbedding</span><span class="p">(</span><span class="n">EmbeddingConfig</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">))</span>

    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Test document </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>

    <span class="c1"># Test asynchronous performance</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="k">await</span> <span class="n">embedding_service</span><span class="o">.</span><span class="n">aembed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
    <span class="n">async_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asynchronous embedding of 1000 texts: </span><span class="si">{</span><span class="n">async_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1000</span>
</pre></div>
</div>
</section>
<section id="best-practices-for-component-implementation">
<h2>Best Practices for Component Implementation<a class="headerlink" href="#best-practices-for-component-implementation" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><strong>Interface Compliance</strong></dt><dd><ul class="simple">
<li><p>Implement all required interface methods completely</p></li>
<li><p>Follow the exact method signatures defined in interfaces</p></li>
<li><p>Return data in the expected format and structure</p></li>
<li><p>Handle errors gracefully without breaking interface contracts</p></li>
</ul>
</dd>
<dt><strong>Configuration Management</strong></dt><dd><ul class="simple">
<li><p>Use environment variables for sensitive configuration like API keys</p></li>
<li><p>Provide sensible defaults for optional configuration</p></li>
<li><p>Validate configuration at initialization time</p></li>
<li><p>Support both programmatic and environment-based configuration</p></li>
</ul>
</dd>
<dt><strong>Error Handling</strong></dt><dd><ul class="simple">
<li><p>Handle provider-specific errors and translate to meaningful messages</p></li>
<li><p>Implement appropriate retry logic for transient failures</p></li>
<li><p>Log errors with sufficient context for debugging</p></li>
<li><p>Fail gracefully without exposing sensitive information</p></li>
</ul>
</dd>
<dt><strong>Performance Optimization</strong></dt><dd><ul class="simple">
<li><p>Implement batching for operations that support it</p></li>
<li><p>Use connection pooling for database/API connections</p></li>
<li><p>Implement appropriate caching strategies</p></li>
<li><p>Support asynchronous operations where beneficial</p></li>
</ul>
</dd>
<dt><strong>Testing and Reliability</strong></dt><dd><ul class="simple">
<li><p>Write comprehensive unit tests with mocked dependencies</p></li>
<li><p>Include integration tests with real services</p></li>
<li><p>Test error conditions and edge cases</p></li>
<li><p>Monitor performance characteristics</p></li>
</ul>
</dd>
</dl>
<p>The reference component implementations provide solid foundations for integrating different providers and services with the Arshai framework. Use them as starting points for your own integrations or as complete solutions if they meet your needs.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="embeddings.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Embedding Implementations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../memory/redis-memory.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Redis Memory Manager</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Nima Nazarian
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Component Reference Implementations</a><ul>
<li><a class="reference internal" href="#available-reference-implementations">Available Reference Implementations</a></li>
<li><a class="reference internal" href="#component-integration-patterns">Component Integration Patterns</a></li>
<li><a class="reference internal" href="#framework-interface-compliance">Framework Interface Compliance</a></li>
<li><a class="reference internal" href="#basic-usage-patterns">Basic Usage Patterns</a></li>
<li><a class="reference internal" href="#component-extension-patterns">Component Extension Patterns</a></li>
<li><a class="reference internal" href="#testing-component-implementations">Testing Component Implementations</a></li>
<li><a class="reference internal" href="#best-practices-for-component-implementation">Best Practices for Component Implementation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=95e61db4"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    </body>
</html>